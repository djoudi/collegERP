CREATE TABLE field_values (id BIGINT AUTO_INCREMENT, value VARCHAR(255) NOT NULL, field_id BIGINT NOT NULL, fielvaluedorder BIGINT DEFAULT 0, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, INDEX field_id_idx (field_id), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = INNODB;
CREATE TABLE fields (id BIGINT AUTO_INCREMENT, fieldname VARCHAR(255) NOT NULL, fieldtype VARCHAR(255) NOT NULL, fieldkey VARCHAR(255) DEFAULT 'field_key' NOT NULL, fieldorder BIGINT DEFAULT 0, isnum BIGINT DEFAULT 0, isreq BIGINT DEFAULT 0, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = INNODB;
CREATE TABLE lesson (id BIGINT AUTO_INCREMENT, lesson_code VARCHAR(255) NOT NULL, prev_lesson BIGINT, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, INDEX prev_lesson_idx (prev_lesson), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = INNODB;
CREATE TABLE lesson_fields (id BIGINT AUTO_INCREMENT, lesson_id BIGINT NOT NULL, field_id BIGINT NOT NULL, value LONGTEXT NOT NULL, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, INDEX lesson_id_idx (lesson_id), INDEX field_id_idx (field_id), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = INNODB;
CREATE TABLE school_year (id BIGINT AUTO_INCREMENT, value VARCHAR(255) NOT NULL, start_at DATE NOT NULL, end_at DATE NOT NULL, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = INNODB;
CREATE TABLE student (id BIGINT AUTO_INCREMENT, student_code VARCHAR(255) NOT NULL, user_id BIGINT NOT NULL, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = INNODB;
CREATE TABLE student_fields (id BIGINT AUTO_INCREMENT, student_id BIGINT NOT NULL, field_id BIGINT NOT NULL, value LONGTEXT NOT NULL, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, INDEX student_id_idx (student_id), INDEX field_id_idx (field_id), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = INNODB;
CREATE TABLE teacher (id BIGINT AUTO_INCREMENT, student_code VARCHAR(255) NOT NULL, user_id BIGINT NOT NULL, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = INNODB;
CREATE TABLE teacher_fields (id BIGINT AUTO_INCREMENT, teacher_id BIGINT NOT NULL, field_id BIGINT NOT NULL, value LONGTEXT NOT NULL, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, INDEX teacher_id_idx (teacher_id), INDEX field_id_idx (field_id), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = INNODB;
ALTER TABLE field_values ADD CONSTRAINT field_values_field_id_fields_id FOREIGN KEY (field_id) REFERENCES fields(id) ON DELETE CASCADE;
ALTER TABLE lesson ADD CONSTRAINT lesson_prev_lesson_lesson_id FOREIGN KEY (prev_lesson) REFERENCES lesson(id) ON DELETE CASCADE;
ALTER TABLE lesson_fields ADD CONSTRAINT lesson_fields_lesson_id_lesson_id FOREIGN KEY (lesson_id) REFERENCES lesson(id) ON DELETE CASCADE;
ALTER TABLE lesson_fields ADD CONSTRAINT lesson_fields_field_id_fields_id FOREIGN KEY (field_id) REFERENCES fields(id) ON DELETE CASCADE;
ALTER TABLE student_fields ADD CONSTRAINT student_fields_student_id_student_id FOREIGN KEY (student_id) REFERENCES student(id) ON DELETE CASCADE;
ALTER TABLE student_fields ADD CONSTRAINT student_fields_field_id_fields_id FOREIGN KEY (field_id) REFERENCES fields(id) ON DELETE CASCADE;
ALTER TABLE teacher_fields ADD CONSTRAINT teacher_fields_teacher_id_teacher_id FOREIGN KEY (teacher_id) REFERENCES teacher(id) ON DELETE CASCADE;
ALTER TABLE teacher_fields ADD CONSTRAINT teacher_fields_field_id_fields_id FOREIGN KEY (field_id) REFERENCES fields(id) ON DELETE CASCADE;
